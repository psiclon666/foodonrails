window.authHandler=new function(){var B="User-cn";var p="AuthFlag";var m="LtpaToken2_prev";var r="Username_prev";var l="authHandler_userData";var n="authHandler_userData_timestamp";var k;var u=window.location.href.indexOf("audit-login-change=force")!==-1;var A=false;var j=b();var t={};function v(H,D){if(!$.cookie){console.error("Ошибка инициализации authHandler: не подключён jQuery Cookie");return}if(H===true){window.PAGEDATA.userIsAuthorized=true;C(p,"true");h();q.clear()}window.authHandler.userIsQuickReg=!!$.cookie("anonymEmail");e();z.init();k=$.cookie("LtpaToken2");f();A=!!$.cookie(B);t.linkLogOut=$(".j-profile-logout");t.linkUserName=$(".j-profile-username");t.blockLinksLogged=$(".j-profile-links-loggedin");t.blockLinksNotLogged=$(".j-profile-links-notlogged");var G;if(window.PAGEDATA.userIsAuthorized===false&&A===true){h();q.clear()}else{if(window.PAGEDATA.userIsAuthorized===true&&A===false){i(H).done(function(K){if(K&&K.cn&&K.cn[0]){G=g(K.cn[0]);C(B,G);window.sessionStorage.setItem(r,K.uid);s(G);if(typeof D==="function"){D(K)}}else{C(p,"false");v()}});x()}else{if(window.PAGEDATA.userIsAuthorized===true&&A===true){s(g($.cookie(B)));x()}else{q.clear()}}}var J=window.location.pathname.indexOf("accessible")!==-1;C("accessible",J);var F=["ru","en","fi","zh","de","fr"];var I=window.location.pathname.split("/");for(var E=0;E<F.length;E++){if(I.indexOf(F[E])!==-1){C("lang",F[E]);break}}$(document).on("ajaxSuccess",c);c()}function f(){window.PAGEDATA.userIsAuthorized=$.cookie(p)==="true";return window.PAGEDATA.userIsAuthorized}this.checkUserAuthStatusByCookie=f;function c(D,G,E,I){if(E&&(E.crossdomain||E._CUSTOM_PROP_DEBUG_LTPA)){return}var F=sessionStorage.getItem(m);if(E){y("Проверка LtpaToken2 инициирована аякс-запросом",E)}if(window.PAGEDATA.userIsAuthorized===false){sessionStorage.removeItem(m);sessionStorage.removeItem(r)}else{if((F&&k&&k!==F&&!!sessionStorage.getItem(r))||u){if(u){UTIL.log("Включен режим эмуляции смены LtpaToken2")}var H={layer_id:window.location.protocol==="https:"?5842:5700,_ARM_ID_:2816,action:"editaccept",URI:window.location.pathname,ORIG_LOGIN:sessionStorage.getItem(r),ORIG_LTPATOKEN2:sessionStorage.getItem(m),LTPATOKEN2:k,EVENT_LAYER_ID:j,};UTIL.log("Кука LtpaToken2 неожиданно изменилась",H);sessionStorage.setItem(m,k);$.ajax({url:"/",data:H,dataType:"json",success:function(J){if(typeof J.ID==="string"){UTIL.log("Отправленный отчёт сохранён с ID="+J.ID);if(t.linkLogOut.length!==0){if(u){y('Сейчас пользователя по идее должно разлогинить путём перехода по ссылке "Выйти" (с параметром force данный переход отключён)')}else{t.linkLogOut[0].click()}}else{UTIL.log('Кнопка "Выход" не найдена, поэтому просто обновляем текущее значение, чтобы не слать бесконечно один и тот же результат на сервер')}}else{UTIL.log("При сохранении отчёта возникла ошибка:\n"+J.ERROR)}},error:function(J){UTIL.log("В результате отправки отчёта произошла ошибка",J)},_CUSTOM_PROP_DEBUG_LTPA:true})}else{sessionStorage.setItem(m,k)}}}function o(){var D=window.location.hostname.split(".").reverse();return D[1]+"."+D[0]}function y(){if(window.location.href.indexOf("audit-login-change=log")!==-1){console.log.apply(console,arguments)}}var w;function i(D){var E=q.get();if(D||(!w&&!E)){w=$.getJSON("/selfcare/user")}else{if(E){w=$.Deferred().resolve(E)}}w.then(q.set);return w}var q={get:function(){var H;var G=window.localStorage.getItem(l);var E=window.localStorage.getItem(n);if(G&&E&&D()){try{H=JSON.parse(localStorage[l]);if(!H.uid){H=void 0}}catch(F){}}return H;function D(){var K=1;var J=new Date(E);J.setHours(J.getHours()+K);var I=window.PAGEDATA.srvDate<J;if(!I){UTIL.log("Данные пользователя запомнены более "+K+" часа назад и следовательно невалидны")}return I}},set:function(D){window.localStorage.setItem(l,JSON.stringify(D));window.localStorage.setItem(n,window.PAGEDATA.srvDate.toISOString())},clear:function(){window.localStorage.removeItem(l)}};this.getUserData=i;function s(D){t.linkUserName.text(D)}function g(D){return D.replace("+"," ")}function d(){t.linkLogOut.on("click",function(){h();window.PAGEDATA.userIsAuthorized=false})}function b(){if(window.UTIL&&window.UTIL.pageData&&window.UTIL.pageData.layer){return window.UTIL.pageData.layer}else{var D=/layer_id=(\d+)/.exec(window.location.search);if(D instanceof Array&&D.length===2){return D[1]|0}}return 0}function h(){a(B);A=false}function a(D){$.cookie(D,"",{expires:-1,path:"/",domain:o()})}function C(E,D){$.cookie(E,D,{expires:365,path:"/",domain:o()})}function x(){t.blockLinksNotLogged.hide();t.blockLinksLogged.show()}function e(){var E=[5732];if(window.authHandler.userIsQuickReg&&window.PAGEDATA&&E.indexOf(window.PAGEDATA.layer)!==-1){var D=window.PAGEDATA.lang==="ru";var G=$('				<div class="modal-mask"> 					<div class="modal-wrapper wide"> 						<div class="modal-container wide"> 							<div class="modal-header"> 								<h5>'+(D?"Для продолжения требуется авторизация/регистрация на сайте":"Authentication/registration on the site is required in order to continue")+'</h5> 							</div> 							<div class="modal-body"> 								<p> 									'+(D?"Данная функциональность не доступна для незарегистрированных пользователей":"This functionality is not available for unregistered users")+". 								</p> 								<p> 									"+(D?"Для использования всех возможностей портала рекомендуем":"In order to use all portal features we reccommend you to")+' <a href="#" class="j-restrict-reg">'+(D?"зарегистрироваться":"register")+"</a>. 									<br/> 									"+(D?"Если у вас уже есть постоянный аккаунт":"If you already have a permanent account")+' <a href="#" class="j-restrict-auth">'+(D?"авторизуйтесь":"log in")+"</a>, "+(D?"пожалуйста":"please")+'. 								</p> 							</div> 							<div class="modal-footer"> 								<a href="/" class="btn btn-default">'+(D?"На главную страницу":"Go to main page")+"</a> 							</div> 						</div> 					</div> 				</div> 			");$("body").prepend(G);var H=window.PAGEDATA.theme==="SPECIAL"?"/accessible":"";$(".j-restrict-auth").on("click",function(I){I.preventDefault();window.sessionStorage.removeItem("selfcare_logonSubmittedBy");F("/universal/logon/"+window.PAGEDATA.lang+H)});$(".j-restrict-reg").on("click",function(I){I.preventDefault();F("/selfcare/register/"+window.PAGEDATA.lang+H)});function F(I){window.location.href="/selfcare/ibm_security_logout?logoutExitPage=https://"+window.location.hostname+I}}}this.init=v;this.reinit=function(D){v(true,D)};this.removeFioCookie=h;this.removeRootDomainCookie=a;this.setRootDomainCookie=C;var z=new function(){var K="gdprcred0";var I="gdprcred1";var O=window.sessionStorage;function F(P,Q){O.setItem(K,J(P));O.setItem(I,J(Q))}function G(){var Q=O.getItem(K);var P=O.getItem(I);return(Q&&P)?{username:E(Q),password:E(P)}:{}}function L(){O.removeItem(K);O.removeItem(I)}function N(){if(window.PAGEDATA&&window.PAGEDATA.layer===6042){window.selfCare.initGdprAgreement(G())}else{if(window.location.pathname.split("/")[2]!=="logonErr"){L()}}}this.init=N;this.saveCredentials=F;this.getCredentials=G;function E(P){return decodeURIComponent(D(P).split("").map(function(Q){return"%"+("00"+Q.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function J(Q){return M(encodeURIComponent(Q).replace(/%([0-9A-F]{2})/g,function P(R,S){return String.fromCharCode("0x"+S)}))}var D=window.atob||H;var M=window.btoa||H;function H(P){return P}};this.saveCred=z.saveCredentials;this.getCred=z.getCredentials};if(!window.PREVENT_AUTHHANDLER_INIT){$(authHandler.init)};