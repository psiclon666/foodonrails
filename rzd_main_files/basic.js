function htmlEscape(a){if(!a){return""}a=a.toString();var b=a.replace(/</g,"&lt;");b=b.replace(/>/g,"&gt;");b=b.replace(/\"/g,"&quot;");return b}function zfill(b,a){b=b.toString();while(b.length<a){b="0"+b}return b}function enableElem(b,a){$(b).attr("disabled",!a).toggleClass("disabled",!a)}function endClick(a){a.preventDefault();return true}function applyTempl(d,b){var a,c=document.getElementById(d);if(c){a=c.innerHTML}else{if(d in window){a=window[d]}else{return""}}return applyTemplS(a,b)}function applyTemplS(g,q){function n(B){var A=g.indexOf("$",B),k=g.indexOf("`",B);return A<0?k:(k<0?A:Math.min(A,k))}q=q||{};var s=0,d=[],l,c=0,v,h,f,y,j,z,o,t,r="<!--",w="-->",e="if",b=/^if /,x="endif",a=/^endif /;for(;;){if((v=n(s))<0){break}h=v+1;if((f=n(h))<0){break}y=g.slice(h,f);j=y[0];if("%!".indexOf(j)>=0){y=y.slice(1)}if(!(y in q)){s=h}else{z=q[y]+"";if(j=="%"){z=encodeURIComponent(z)}else{if(j=="!"){z=htmlEscape(z)}}d.push(g.slice(c,v),z);c=s=f+1}}if(d.length){d.push(g.slice(c));g=d.join("")}d=g.split(r);l=d[0];for(s=1;s<d.length;s++){o=d[s].split(w);if(o.length!=2){return g}t=o[0];if(b.test(t)||a.test(t)){t=t.split(" ");o.push(t[0]);t=t[1];if(t[0]=="!"){o.push(t.slice(1),1)}else{o.push(t)}}d[s]=o}function u(k,F,D){var B=k[3],E=F;while(E<D){var C=d[E];if(C[2]==x&&C[3]==B){break}E++}if(E<D){var A=q[B];if(k[4]){A=!A}if(A){l+=k[1];if(E>F){m(F,E)}}l+=d[E][1];E++}return E}function m(B,A){while(B<A){var k=d[B++];if(k[2]==e){B=u(k,B,A)}else{l+=k[1]}}}m(1,d.length);return l}function applyTemplV(c,a){var b,d="";for(b in a){d+=applyTempl(c,a[b])}return d}function lang(c,b,h){var d;if(window.Lang){if(c=="[N] days"){var f=b.N,g=Lang.$ID,e="";if(g=="ru"){f=f%100;if(f>20){f=f%10}if(f==1){e="|1"}else{if(f>1&&f<5){e="|2"}}}else{if(g=="en"){if(f===1){e="|1"}}}d=Lang[c+e]||Lang[c]}else{if(!$.isArray(c)){if(Lang[c]){d=Lang[c]}}else{d=Lang;for(var a=0;d&&a<c.length;a++){d=d[c[a]]}}}}if(d===undefined){d=h===undefined?c:h}if(b){for(var a in b){d=d.replace(new RegExp("\\["+a+"\\]","g"),b[a])}}return d}function lang$(c,b,d){var a=lang(c,b,d);for(var c in b){a=a.split("$"+c+"$").join(b[c])}return a}function capitalize(f){var h,a=true,g="";for(var e=0;e<f.length;e++){h=f.charAt(e);h=a?h.toUpperCase():h.toLowerCase();a=h==" "||h=="-"||h=="(";g+=h}return g}function showError(b){var a=b.name?b.name:"Error";a+=": "+b.message;if(b.fileName){a+="\nFile: "+b.fileName}if(b.lineNumber){a+="\nLine: "+b.lineNumber}if(b.stack){a+="\nStack:\n"+b.stack}console.log(a)}function stepDateElem(c,b,a){if(typeof(c)=="string"){c=document.getElementById(c)}if(!c){return}var e=new TicketDate(c.value);if(!e.isOk()){return}e.addDays(b);c.value=e.toString();var f=typeof(a);if(f=="function"){a(c)}}function stepDowDate(c,b,a){if(typeof(c)=="string"){c=document.getElementById(c)}if(!c){return}var e=new TicketDate(c.value.split(",")[0]);if(!e.isOk()){return}e.addDays(b);c.value=e.toString("DOW");var f=typeof(a);if(f=="function"){a(c)}}function setCookie(b,d,a,f,c,e){document.cookie=b+"="+escape(d)+((a)?"; expires="+a:"")+((f)?"; path="+f:"")+((c)?"; domain="+c:"")+((e)?"; secure":"")}var TransLit=function(){var c="А:A;Б:B;В:V;Г:G;Д:D;Е:E;Ё:YO;Ж:ZH;З:Z;И:I;Й:Y;К:K;Л:L;М:M;Н:N;О:O;П:P;Р:R;С:S;Т:T;У:U;Ф:F;Х:KH;Ц:TC;Ч:CH;Ш:SH;Щ:SHC;Ъ:';Ы:Y;Ь:';Э:E';Ю:YU;Я:YA";var b={};function a(f){var e,g,d=f.split(";");for(e in d){g=d[e].split(":");b[g[0]]=g[1]}}a(c);a(c.toLowerCase());return{map:b}}();function transliterate(e){var d,g,b=e.length,f="",a=TransLit.map;for(d=0;d<b;d++){g=e.charAt(d);f+=(g in a)?a[g]:g}return f}function datePickerLoc(b){function a(d){var c,e=[];for(c=1;c!=8;c++){e[c%7]=d[c-1]}return e}return $.extend({},{dateFormat:"dd.mm.yy",monthNames:Lang.Months,monthNamesShort:Lang.Months,dayNames:a(Lang.WeekDays),dayNamesMin:a(Lang.WeekDaysShort),firstDay:1},b)}function datePickerToday(){$.datepicker._gotoToday=function(d){var c=$(d);var b=this._getInst(c[0]);if(this._get(b,"gotoCurrent")&&b.currentDay){b.selectedDay=b.currentDay;b.drawMonth=b.selectedMonth=b.currentMonth;b.drawYear=b.selectedYear=b.currentYear}else{var a=new Date();b.selectedDay=a.getDate();b.drawMonth=b.selectedMonth=a.getMonth();b.drawYear=b.selectedYear=a.getFullYear();this._setDateDatepicker(c,a);this._selectDate(d,this._getDateDatepicker(c))}this._notifyChange(b);this._adjustDate(c)}}function moneyFmt(a){var c=Math.floor(a);var b=c.toString();i=b.length-3;while(i>0){b=b.substring(0,i)+"&nbsp;"+b.substring(i);i-=3}if(a-c>=0.01){b+=(a-c).toFixed(2).substring(1)}return b}function paramErrLog(e){var a={log:1,err:1},b,d,c=location.search.substring(1).split("&");for(b in c){d=c[b].split("=");if(d[0] in a){e[d[0]]=decodeURIComponent(d[1])}}return e}function GetParams(){var d={},a,c,b=location.search.substring(1).split("&");for(a in b){c=b[a].split("=");d[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}return d}function AsyncRequest(c,b){this.type="post";this.errField="error";b=b||1000;var g=[],d=[];var f=null;this.isActive=function(){return f!=null};function e(){f=new Object();f.ok=true;return f}function a(h){h.ok=false;if(h==f){f=null}}this.addHandler=function(k,j,l){var h=j?d:g;if(l){h.length=0}if(k){h.push(k)}};this.request=function(m,q,o,l){paramErrLog(m);var h=this,r=this.type,k=this.errField;this.cancel();this.addHandler(q);this.addHandler(o,1);var j=e();function s(w,u){if(!j.ok){return}for(var v in d){d[v](w,u)}if(l){l()}a(j)}function t(u){if(!j.ok){return}if(!u){u={error:""}}var w=u[k];if(w!==undefined){return s(w||lang("Server Error"),u)}if(window.MosTime){MosTime.set(u)}if(u.result=="RID"){m.rid=u.RID;if(h.onRID){h.onRID(m,u)}setTimeout(n,b);return}a(j);for(var v in g){g[v](u)}g.length=0;if(l){l()}}function n(){if(!j.ok){return}$.ajax({url:c,data:m,type:r,dataType:"json",success:t,error:function(v,u,w){s("Ошибка запроса. "+u+": "+w)}})}n()};this.cancel=function(){g.length=0;d.length=0;if(f){a(f)}}}function checkJSON(){if("JSON" in window){return}window.JSON={stringify:function(obj){var t=typeof(obj);if(t!="object"||obj===null){if(t=="string"){obj='"'+obj+'"'}return String(obj)}else{var n,v,json=[],arr=(obj&&obj.constructor==Array);for(n in obj){v=obj[n];t=typeof(v);if(t=="string"){v='"'+v+'"'}else{if(t=="object"&&v!==null){v=JSON.stringify(v)}}json.push((arr?"":'"'+n+'":')+String(v))}}return(arr?"[":"{")+String(json)+(arr?"]":"}")},parse:function(str){if(str===""){str='""'}eval("var p="+str+";");return p}}}function clearForm(c){var a=document.forms[c];for(var b=0;b<a.elements.length;b++){if(a.elements[b].type=="text"){a.elements[b].value=""}if(a.elements[b].type=="select-one"){a.elements[b].value=""}if(a.elements[b].type=="checkbox"){a.elements[b].checked=false}if(a.elements[b].type=="radio"){a.elements[b].value="0";a.elements[b].checked=false}}}function testAttribute(a,b){var c=document.createElement(a);if(b in c){return true}else{return false}}function setPlaceholders(){if(testAttribute("input","placeholder")===true){return}$("input[placeholder]").each(function(){var a=$(this).attr("placeholder");if($(this).val()===""){$(this).val(a)}}).focus(function(){if($(this).val()===$(this).attr("placeholder")){$(this).val("")}}).blur(function(){if($(this).val()===""){$(this).val($(this).attr("placeholder"))}})}function sliceString(f,g,d){f=f.toString();var j="";var e;var b=[];var c;var a=f.length;if(d===undefined){d="&nbsp;"}if(g===undefined){g=3}var h;if(a>g){h=a%g;c=Math.ceil(a/g);if(h!=0){b.push(f.substr(a*-1,h));f=f.substr(h)}e=Math.ceil(f.length/g);for(i=0;i<e;i++){strProc=strProc=f.substr(i*g,g);b.push(strProc)}j=b.join(d)}else{j=f}return j}function getRotatePosFix(a,b){return(a-b)/2}function transportName(a){return lang(a.bus?"Bus":"Train")}window.requestAFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(a){return window.setTimeout(a,16.7)}})();window.cancelAFrame=(function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||function(a){window.clearTimeout(a)}})();function StdErrorBox(c,b){var a=$(applyTempl("TmStdErrorBox",$.extend({message:c},b)));return a}function copyFields(g,e,a){var c,d,f,b;for(c in a){d=a[c];if(typeof d=="string"){f=b=d}else{f=d[0];b=d[1]}if(f in e){g[b]=e[f]}}return g}function splitP(b,d){var a=[],c=0,e=0,f=0;while(e>=0){e=b.indexOf(d,e+1);a[c++]=b.slice(f,e);f=e+1}return a};